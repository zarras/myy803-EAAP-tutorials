package myy803.eaap.tablemodulegateway.example.modules;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import myy803.eaap.tablemodulegateway.example.gateways.StopGateway;

public class StopModule {
	public static final int STOP_STATUS_OK = 0;
	public static final int STOP_STATUS_CLOSED = 1;
	
	
	public void changeStopStatus(int stopId, int status) {
			StopGateway stopGateway = new StopGateway();
			
			try {
				ResultSet rSet = stopGateway.findStopsById(stopId);
				if(rSet.next()) {
					stopGateway.updateStop(
							stopId,
							rSet.getString("name"),
							status,
							rSet.getDouble("latitude"),
							rSet.getDouble("longtitude"),
							rSet.getInt("route_id")
						);
				}
				
			} catch (SQLException e) {
				e.printStackTrace();
			}		
	}
	
	public String checkStopStatus(int stopId) {
		String statusReport = "";
		StopGateway stopGateway = new StopGateway();

		try {
			ResultSet rSet = stopGateway.findStopsById(stopId);
			if(rSet.next()) {
				int stopStatus = rSet.getInt("status");
				if(stopStatus == StopGateway.STOP_STATUS_OK)
					statusReport = "Bus stop " + stopId + " is FUNCTIONAL";
				else 
					statusReport = "Bus stop " + stopId + " is CLOSED";
			}
			
			connection.close();	
		} catch (SQLException e) {
			e.printStackTrace();
		}

		return statusReport;
	}
	
	public ResultSet findStopsByRouteId(int routeId) throws SQLException {
		Connection connection = DriverManager.getConnection("jdbc:mysql://localhost:3306/city_bus_schema", "root", "root");
		PreparedStatement stm = connection.prepareStatement("SELECT * FROM stops WHERE route_id = ?");
		stm.setInt(1, routeId);
		ResultSet rs = stm.executeQuery();
		//connection.close();
		return rs;
	}
}
